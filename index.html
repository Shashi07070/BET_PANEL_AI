<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Cricket Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --header-black: #d32f2f; /* Darker red from screenshot */
            --bg-gray: #f2f4f7;
            --back-blue: #72bbef;
            --lay-pink: #faa9ba;
            --back-blue-light: #e6f5ff;
            --lay-pink-light: #fff0f5;
            --text-dark: #333;
            --green: #008000;
            --red: #d0021b;
        }

        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding-bottom: 100px;
        }

        /* --- HEADER --- */
        .app-header {
            background: #2d2d2d;
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
        }
        .balance-badge {
            background: #444;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        /* --- ADMIN PANEL --- */
        .admin-panel {
            background: white;
            margin: 10px;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .admin-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-end; }
        .admin-col { flex: 1; }
        .admin-label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        .admin-input { 
            width: 100%; padding: 8px; border: 1px solid #ccc; 
            border-radius: 4px; box-sizing: border-box; font-family: inherit; 
        }
        h3 { margin: 0 0 10px 0; font-size: 14px; color: #555; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* --- MARKET CARD STYLES (EXACT UI) --- */
        .market-card {
            background: white;
            margin: 10px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-bottom: 1px solid #eee;
        }

        /* The Red Tag Shape */
        .market-title-tag {
            background-color: var(--header-red);
            color: white;
            padding: 5px 15px 5px 10px;
            font-weight: 700;
            font-size: 16px;
            position: relative;
            clip-path: polygon(0 0, 90% 0, 100% 100%, 0% 100%);
            display: flex;
            align-items: center;
            min-width: 120px;
        }

        .cashout-pill {
            background: #bd202d;
            border: 1px solid white;
            border-radius: 3px;
            padding: 1px 5px;
            font-size: 10px;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }

        .market-info {
            font-size: 11px;
            color: #666;
            padding-right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .info-icon {
            background: #bd202d;
            color: white;
            width: 14px; height: 14px;
            border-radius: 50%;
            text-align: center;
            line-height: 14px;
            font-weight: bold;
        }

        /* Sub Headers (Back/Lay) */
        .sub-header {
            display: flex;
            padding: 5px 10px;
            background: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
        }
        .empty-col { flex: 1; } /* Space for team name */
        .odds-header { 
            width: 110px; /* Width of two buttons */
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            color: #555;
            display: flex;
            justify-content: space-between;
            padding: 0 5px;
        }

        /* Runner Row */
        .runner-row {
            display: flex;
            border-bottom: 1px solid #f0f0f0;
            min-height: 60px;
        }
        .runner-info {
            flex: 1;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .runner-name {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .pnl {
            font-size: 12px;
            margin-top: 2px;
            font-weight: 700;
        }
        .green { color: var(--green); }
        .red { color: var(--red); }

        .odds-container {
            display: flex;
        }
        .odds-box {
            width: 55px;
            height: 100%;
            border: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-left: 1px;
        }
        .back-box { background-color: var(--back-blue); }
        .lay-box { background-color: var(--lay-pink); }
        
        .price { font-size: 18px; font-weight: 700; color: #1e1e1e; }
        .vol { font-size: 11px; color: #333; opacity: 0.8; }

        /* Footer Note */
        .market-footer {
            background: #f5f5f5;
            color: #888;
            font-size: 11px;
            padding: 8px 10px;
            text-transform: uppercase;
        }

        /* --- BETSLIP POPUP --- */
        .betslip-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); display: none; z-index: 99;
        }
        .betslip {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 20px;
            border-radius: 15px 15px 0 0;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .betslip.active { transform: translateY(0); }
        
        .slip-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 18px; font-weight: bold; }
        .place-btn {
            width: 100%; padding: 15px; border: none; border-radius: 5px;
            font-size: 16px; font-weight: bold; color: white; cursor: pointer;
        }
        .stake-input { padding: 10px; width: 100%; font-size: 16px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;}
    </style>
</head>
<body>

<div class="app-header">
    <div><b>CRICKET</b>EXCH</div>
    <div class="balance-badge">PTS: <span id="main-balance">100000</span></div>
</div>

<div class="admin-panel">
    <h3>‚öôÔ∏è Operator Panel</h3>
    
    <div class="admin-row">
        <div class="admin-col">
            <label class="admin-label">Team A</label>
            <input type="text" id="teamA_name" class="admin-input" value="Janakpur Bolts">
        </div>
        <div class="admin-col">
            <label class="admin-label">Team B</label>
            <input type="text" id="teamB_name" class="admin-input" value="Chitwan Rhinos">
        </div>
    </div>

    <div class="admin-row">
        <div class="admin-col">
            <label class="admin-label">Market Title (Editable)</label>
            <input type="text" id="market_title_1" class="admin-input" value="MATCH ODDS">
        </div>
        <div class="admin-col">
            <label class="admin-label">Team A Back (Decimal)</label>
            <input type="number" id="mo_input" class="admin-input" value="1.90" step="0.01" oninput="calcMatchOdds()">
        </div>
    </div>

    <div class="admin-row">
        <div class="admin-col">
            <label class="admin-label">Bookmaker Title</label>
            <input type="text" id="market_title_2" class="admin-input" value="BOOKMAKER">
        </div>
        <div class="admin-col">
            <label class="admin-label">Team A Back (Integer)</label>
            <input type="number" id="bm_input" class="admin-input" value="65" oninput="calcBookmaker()">
        </div>
        <div class="admin-col" style="flex:0.5">
            <button onclick="updateAll()" style="height:35px; background:#333; color:white; border:none; border-radius:4px; width:100%;">Set</button>
        </div>
    </div>
</div>

<div class="market-card">
    <div class="market-header">
        <div class="market-title-tag">
            <span id="disp_title_1">MATCH ODDS</span>
            <div class="cashout-pill" onclick="doCashout('MO')">CASHOUT</div>
        </div>
        <div class="market-info">
            Min: 100 | Max: 10k <div class="info-icon">i</div>
        </div>
    </div>

    <div class="sub-header">
        <div class="empty-col"></div>
        <div class="odds-header">
            <span>BACK</span> <span>LAY</span>
        </div>
    </div>

    <div class="runner-row">
        <div class="runner-info">
            <div class="runner-name" id="disp_teamA_1">Team A</div>
            <div class="pnl" id="pnl_A_1">0.00</div>
        </div>
        <div class="odds-container">
            <button class="odds-box back-box" onclick="openSlip('A', 'back', 'MO')">
                <span class="price" id="mo_back_A">1.90</span>
                <span class="vol">546k</span>
            </button>
            <button class="odds-box lay-box" onclick="openSlip('A', 'lay', 'MO')">
                <span class="price" id="mo_lay_A">1.92</span>
                <span class="vol">12k</span>
            </button>
        </div>
    </div>

    <div class="runner-row">
        <div class="runner-info">
            <div class="runner-name" id="disp_teamB_1">Team B</div>
            <div class="pnl" id="pnl_B_1">0.00</div>
        </div>
        <div class="odds-container">
            <button class="odds-box back-box" onclick="openSlip('B', 'back', 'MO')">
                <span class="price" id="mo_back_B">2.08</span>
                <span class="vol">800k</span>
            </button>
            <button class="odds-box lay-box" onclick="openSlip('B', 'lay', 'MO')">
                <span class="price" id="mo_lay_B">2.12</span>
                <span class="vol">489k</span>
            </button>
        </div>
    </div>
    <div class="market-footer">Allowed In Our Exchange</div>
</div>

<div class="market-card">
    <div class="market-header">
        <div class="market-title-tag">
            <span id="disp_title_2">BOOKMAKER</span>
            <div class="cashout-pill">CASHOUT</div>
        </div>
        <div class="market-info">
            Min: 100 | Max: 50k <div class="info-icon">i</div>
        </div>
    </div>

    <div class="sub-header">
        <div class="empty-col"></div>
        <div class="odds-header">
            <span>BACK</span> <span>LAY</span>
        </div>
    </div>

    <div class="runner-row">
        <div class="runner-info">
            <div class="runner-name" id="disp_teamA_2">Team A</div>
            <div class="pnl" id="pnl_A_2">0.00</div>
        </div>
        <div class="odds-container">
            <button class="odds-box back-box" onclick="openSlip('A', 'back', 'BM')">
                <span class="price" id="bm_back_A">65</span>
                <span class="vol">25k</span>
            </button>
            <button class="odds-box lay-box" onclick="openSlip('A', 'lay', 'BM')">
                <span class="price" id="bm_lay_A">70</span>
                <span class="vol">25k</span>
            </button>
        </div>
    </div>

    <div class="runner-row">
        <div class="runner-info">
            <div class="runner-name" id="disp_teamB_2">Team B</div>
            <div class="pnl" id="pnl_B_2">0.00</div>
        </div>
        <div class="odds-container">
            <button class="odds-box back-box" onclick="openSlip('B', 'back', 'BM')">
                <span class="price" id="bm_back_B">132</span>
                <span class="vol">25k</span>
            </button>
            <button class="odds-box lay-box" onclick="openSlip('B', 'lay', 'BM')">
                <span class="price" id="bm_lay_B">154</span>
                <span class="vol">25k</span>
            </button>
        </div>
    </div>
    <div class="market-footer">Advance Match Bets Started üèè</div>
</div>

<div class="betslip-overlay" id="overlay" onclick="closeSlip()"></div>
<div class="betslip" id="betslip">
    <div class="slip-header">
        <span id="slip-title">Place Bet</span>
        <span style="color:red; cursor:pointer;" onclick="closeSlip()">‚úï</span>
    </div>
    
    <div style="margin-bottom:10px; display:flex; justify-content:space-between;">
        <span>Odds: <b id="slip-odds">0</b></span>
        <span id="slip-info"></span>
    </div>

    <input type="number" id="stake" class="stake-input" placeholder="Stake Amount">
    
    <div style="display:flex; gap:5px; margin-bottom:15px;">
        <button onclick="addStake(1000)" style="flex:1; padding:8px; background:#eee; border:1px solid #ddd;">+1k</button>
        <button onclick="addStake(5000)" style="flex:1; padding:8px; background:#eee; border:1px solid #ddd;">+5k</button>
        <button onclick="addStake(25000)" style="flex:1; padding:8px; background:#eee; border:1px solid #ddd;">+25k</button>
    </div>

    <button id="placeBtn" class="place-btn" onclick="confirmBet()">PLACE BET</button>
</div>

<script>
    // --- STATE ---
    let balance = 100000;
    
    let state = {
        teamA: "Janakpur Bolts",
        teamB: "Chitwan Rhinos",
        mo_odds: { A_back: 1.90, A_lay: 1.92, B_back: 2.08, B_lay: 2.12 },
        bm_odds: { A_back: 65, A_lay: 70, B_back: 132, B_lay: 154 }
    };

    // Tracks Profit/Loss per team
    let pnl = { A: 0, B: 0 };

    let selection = null; // { team: 'A', type: 'back', market: 'MO', odds: 1.9 }

    // --- LOGIC ---
    function init() {
        calcMatchOdds();
        calcBookmaker();
        render();
    }

    // 1. Calculate DECIMAL ODDS (Match Odds)
    function calcMatchOdds() {
        let val = parseFloat(document.getElementById('mo_input').value) || 1.01;
        if(val < 1.01) val = 1.01;
        
        // Auto-calculate Team B based on probability
        let probA = 1 / val;
        let probB = 1 - probA;
        let valB = 1 / probB;

        state.mo_odds.A_back = val;
        state.mo_odds.A_lay = val + 0.02; // Small spread

        state.mo_odds.B_back = valB - 0.05; // Margin
        state.mo_odds.B_lay = valB + 0.04;
        
        render();
    }

    // 2. Calculate BOOKMAKER ODDS (Integer with spread)
    function calcBookmaker() {
        let val = parseInt(document.getElementById('bm_input').value) || 0;
        
        // In Bookmaker:
        // Input 65 -> Back 65. Lay = Back + Spread (e.g. 5) -> 70.
        // Opposite team is roughly (100 - Input) * adjustment
        
        state.bm_odds.A_back = val;
        state.bm_odds.A_lay = val + 5; // The "5p commission" difference you asked for

        // Auto calc B roughly
        // If A is 65 (approx 65% chance), B is approx 35ish
        // We simulate this for the UI
        let inverse = 100 - val; 
        // Add some market noise
        let valB = parseInt(inverse * 2); // Arbitrary scale for bookmaker "rate" style seen in screenshot (132 etc)
        
        if(valB < 0) valB = 0;

        state.bm_odds.B_back = valB;
        state.bm_odds.B_lay = valB + 6; // slightly wider spread for outsider

        render();
    }

    function updateAll() {
        state.teamA = document.getElementById('teamA_name').value;
        state.teamB = document.getElementById('teamB_name').value;
        document.getElementById('disp_title_1').innerText = document.getElementById('market_title_1').value;
        document.getElementById('disp_title_2').innerText = document.getElementById('market_title_2').value;
        calcMatchOdds();
        calcBookmaker();
    }

    // --- RENDER UI ---
    function render() {
        // Names
        ['disp_teamA_1', 'disp_teamA_2'].forEach(id => document.getElementById(id).innerText = state.teamA);
        ['disp_teamB_1', 'disp_teamB_2'].forEach(id => document.getElementById(id).innerText = state.teamB);

        // Match Odds Buttons
        document.getElementById('mo_back_A').innerText = state.mo_odds.A_back.toFixed(2);
        document.getElementById('mo_lay_A').innerText = state.mo_odds.A_lay.toFixed(2);
        document.getElementById('mo_back_B').innerText = state.mo_odds.B_back.toFixed(2);
        document.getElementById('mo_lay_B').innerText = state.mo_odds.B_lay.toFixed(2);

        // Bookmaker Buttons
        document.getElementById('bm_back_A').innerText = state.bm_odds.A_back;
        document.getElementById('bm_lay_A').innerText = state.bm_odds.A_lay;
        document.getElementById('bm_back_B').innerText = state.bm_odds.B_back;
        document.getElementById('bm_lay_B').innerText = state.bm_odds.B_lay;

        // PNL Colors
        updatePnLUI('pnl_A_1', pnl.A);
        updatePnLUI('pnl_B_1', pnl.B);
        updatePnLUI('pnl_A_2', pnl.A);
        updatePnLUI('pnl_B_2', pnl.B);

        document.getElementById('main-balance').innerText = Math.floor(balance);
    }

    function updatePnLUI(id, val) {
        const el = document.getElementById(id);
        el.innerText = val >= 0 ? "+" + val.toFixed(0) : val.toFixed(0);
        el.className = "pnl " + (val >= 0 ? "green" : "red");
    }

    // --- BETTING ---
    function openSlip(team, type, marketType) {
        selection = { team, type, marketType };
        let odds = 0;
        
        // Determine Odds
        if(marketType === 'MO') {
            if(team === 'A') odds = type === 'back' ? state.mo_odds.A_back : state.mo_odds.A_lay;
            else odds = type === 'back' ? state.mo_odds.B_back : state.mo_odds.B_lay;
        } else {
            // BM Logic
            if(team === 'A') odds = type === 'back' ? state.bm_odds.A_back : state.bm_odds.A_lay;
            else odds = type === 'back' ? state.bm_odds.B_back : state.bm_odds.B_lay;
            
            // For calculation purposes, Convert BM Integer to Decimal equiv if needed, 
            // OR treat as "Rate". Usually Rate 65 means: Stake 100 wins 65.
            // So Decimal = 1.65
            odds = (odds / 100) + 1;
        }

        selection.odds = odds;

        // UI Setup
        const overlay = document.getElementById('overlay');
        const slip = document.getElementById('betslip');
        const btn = document.getElementById('placeBtn');
        const title = document.getElementById('slip-title');

        overlay.style.display = 'block';
        setTimeout(() => slip.classList.add('active'), 10); // Anim

        document.getElementById('slip-odds').innerText = marketType === 'BM' ? (odds-1)*100 : odds.toFixed(2);
        
        let teamName = team === 'A' ? state.teamA : state.teamB;
        title.innerText = (type === 'back' ? "BACK " : "LAY ") + teamName;
        
        if(type === 'back') {
            btn.style.backgroundColor = "var(--back-blue)";
            title.style.color = "var(--back-blue)";
        } else {
            btn.style.backgroundColor = "var(--lay-pink)";
            title.style.color = "var(--lay-pink)";
        }
    }

    function closeSlip() {
        const slip = document.getElementById('betslip');
        slip.classList.remove('active');
        setTimeout(() => document.getElementById('overlay').style.display = 'none', 300);
    }

    function addStake(amt) {
        const el = document.getElementById('stake');
        let curr = parseFloat(el.value) || 0;
        el.value = curr + amt;
    }

    function confirmBet() {
        const stake = parseFloat(document.getElementById('stake').value);
        if(!stake || stake <= 0) return;

        // Simple PnL Logic
        // Back A: A(+Profit), B(-Stake)
        // Lay A: A(-Liability), B(+Stake)
        
        let profit = stake * (selection.odds - 1);
        let liability = profit; // For lay

        if(selection.type === 'back') {
            if(selection.team === 'A') {
                pnl.A += profit;
                pnl.B -= stake;
            } else {
                pnl.B += profit;
                pnl.A -= stake;
            }
        } else {
            if(selection.team === 'A') {
                pnl.A -= liability;
                pnl.B += stake;
            } else {
                pnl.B -= liability;
                pnl.A += stake;
            }
        }

        closeSlip();
        render();
    }

    function doCashout(marketType) {
        // Simple visual simulation of cashout
        // Flattens the green book
        let total = (pnl.A + pnl.B) / 2; // Rough avg
        if(total < 0) total = 0; 
        
        balance += total;
        pnl.A = 0;
        pnl.B = 0;
        alert("Cashed out: " + total.toFixed(0));
        render();
    }

    // Start
    init();

</script>
</body>
</html>
